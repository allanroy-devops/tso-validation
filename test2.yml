---

- hosts: all
  gather_facts: false
  become_method: runas
  
  vars:  
    serverlist:
      - server1: win2012r2
        server2: vm1
        port: 22
        
#PortQry.exe /n {{ servers.server2 }} /p tcp /e {{ item.port }}      
#PortQry.exe /n {{ server1 }} /p tcp /e {{ port1 }}           

  tasks:
    - name: Check if remote host port
      win_shell: PortQry.exe /n {{ item.server2 }} /p tcp /e {{ item.port }}      
      args:
        executable: cmd      
      ignore_errors: True
      when: item.server1 == ansible_hostname
      with_items: "{{ serverlist }}"
  
  #register: out
 #   - debug: var=out  
